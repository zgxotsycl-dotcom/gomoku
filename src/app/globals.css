@tailwind base;
@tailwind components;
@tailwind utilities;

/* Winning Shake Animation */
@keyframes board-shake {
  0%, 100% {
    transform: translateX(0);
  }
  10%, 30%, 50%, 70%, 90% {
    transform: translateX(-5px);
  }
  20%, 40%, 60%, 80% {
    transform: translateX(5px);
  }
}

.animate-board-shake {
  animation: board-shake 0.5s ease-in-out;
}


/* Dark Leather Texture Background */
.main-background {
  background-color: #1c1c1c; /* Dark base */
  background-image: 
    linear-gradient(335deg, rgba(255,255,255,0.03) 2px, transparent 2px),
    linear-gradient(155deg, rgba(255,255,255,0.03) 2px, transparent 2px),
    linear-gradient(335deg, rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(155deg, rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size: 8px 8px, 8px 8px, 4px 4px, 4px 4px;
  background-position: 0px 0px, 4px 4px, 2px 2px, 6px 6px;
}

/* AI anticipation background for mode selection */
@keyframes node-float {
  0% { transform: translateY(0) translateX(0) scale(1); opacity: 0.35; }
  50% { transform: translateY(-22px) translateX(10px) scale(1.05); opacity: 0.6; }
  100% { transform: translateY(0) translateX(0) scale(1); opacity: 0.35; }
}
@keyframes connector-pulse {
  0%, 100% { opacity: 0.15; }
  50% { opacity: 0.5; }
}
.ai-anticipation {
  position: absolute;
  inset: 0;
  overflow: hidden;
}
.ai-node {
  position: absolute;
  width: 180px; height: 180px;
  border-radius: 9999px;
  filter: blur(16px);
  background: radial-gradient(circle at 30% 30%, rgba(0,255,200,0.5), rgba(0,0,0,0));
  animation: node-float 7s ease-in-out infinite;
}
.ai-node.n1 { top: 15%; left: 12%; background: radial-gradient(circle at 40% 40%, rgba(0,255,200,0.45), rgba(0,0,0,0)); animation-delay: 0s; }
.ai-node.n2 { top: 28%; right: 18%; background: radial-gradient(circle at 60% 60%, rgba(0,150,255,0.5), rgba(0,0,0,0)); animation-delay: .8s; }
.ai-node.n3 { bottom: 18%; left: 20%; background: radial-gradient(circle at 50% 60%, rgba(255,80,220,0.45), rgba(0,0,0,0)); animation-delay: 1.2s; }
.ai-node.n4 { bottom: 22%; right: 24%; background: radial-gradient(circle at 40% 50%, rgba(255,200,80,0.45), rgba(0,0,0,0)); animation-delay: .4s; }
.ai-node.n5 { top: 46%; left: 46%; width: 240px; height: 240px; background: radial-gradient(circle at 50% 50%, rgba(120,220,255,0.35), rgba(0,0,0,0)); animation-delay: 1.6s; }
.ai-connector { position: absolute; height: 2px; background: linear-gradient(90deg, rgba(0,255,200,0), rgba(0,255,200,0.6), rgba(0,255,200,0)); filter: blur(1px); animation: connector-pulse 2.4s ease-in-out infinite; }
.ai-connector.c1 { top: 30%; left: 15%; width: 30%; }
.ai-connector.c2 { top: 55%; left: 25%; width: 40%; animation-delay: .6s; }
.ai-connector.c3 { top: 40%; left: 50%; width: 30%; animation-delay: 1.1s; }

/* Chroma Nebula Animation Background */
@keyframes flow-nebula {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

.nebula-background {
  background: linear-gradient(270deg, #ff00ff, #00ffff, #ffff00, #00ff00, #ff00ff);
  background-size: 1000% 1000%;
  animation: flow-nebula 60s ease infinite;
  opacity: 0.15; /* Subtle effect */
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1; /* Place it behind the main content */
}


/* Board and Stone Design (from previous steps) */
.goboard {
    background: linear-gradient(145deg, #d2b48c, #b89a74);
    box-shadow: 10px 10px 30px rgba(0,0,0,0.4), inset 0 0 10px rgba(0,0,0,0.2);
    border: 2px solid #4a3f35;
}

.goboard-line {
    background-color: rgba(0, 0, 0, 0.4);
}

.stone-shadow {
    box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
}

@keyframes wobble {
  0% { transform: rotate(0deg); }
  15% { transform: rotate(-5deg); }
  30% { transform: rotate(3deg); }
  45% { transform: rotate(-3deg); }
  60% { transform: rotate(2deg); }
  75% { transform: rotate(-1deg); }
  100% { transform: rotate(0deg); }
}

.locked-feature:hover .lock-icon {
  animation: wobble 0.8s ease-in-out;
}

@keyframes stone-pop {
  0% { transform: scale(0.3); opacity: 0; }
  80% { transform: scale(1.1); }
  100% { transform: scale(1); opacity: 1; }
}

.animate-stone-pop {
  animation: stone-pop 0.3s ease-out;
}

/* Space Background for PVA Mode */
.space-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
  z-index: -1;
}

/* Fullscreen iframe for AI대전 cosmos background */
.cosmos-bg-iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: 0;
  pointer-events: none; /* make background non-interactive */
  z-index: 0;
}

@keyframes move-stars {
  from { transform: translateY(0px); }
  to   { transform: translateY(-2000px); }
}

.stars, .stars2, .stars3 {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 2000px; /* Taller than the view to allow for animation */
  background-repeat: repeat;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
}

.stars {
  background-image: radial-gradient(1px 1px at 20px 30px, #eee, rgba(0,0,0,0)),
                    radial-gradient(1px 1px at 40px 70px, #fff, rgba(0,0,0,0)),
                    radial-gradient(1px 1px at 90px 40px, #fff, rgba(0,0,0,0)),
                    radial-gradient(1.5px 1.5px at 130px 80px, #fff, rgba(0,0,0,0)),
                    radial-gradient(1.5px 1.5px at 160px 120px, #ddd, rgba(0,0,0,0));
  background-size: 200px 200px;
  animation-name: move-stars;
  animation-duration: 200s;
}

.stars2 {
  background-image: radial-gradient(1px 1px at 50px 20px, #fff, rgba(0,0,0,0)),
                    radial-gradient(1px 1px at 100px 90px, #ddd, rgba(0,0,0,0)),
                    radial-gradient(1.5px 1.5px at 150px 60px, #fff, rgba(0,0,0,0));
  background-size: 300px 300px;
  animation-name: move-stars;
  animation-duration: 150s;
}

.stars3 {
  background-image: radial-gradient(1.5px 1.5px at 80px 100px, #fff, rgba(0,0,0,0)),
                    radial-gradient(1.5px 1.5px at 180px 40px, #ddd, rgba(0,0,0,0));
  background-size: 400px 400px;
  animation-name: move-stars;
  animation-duration: 100s;
}

/* High-fidelity nebula field */
.nebula-field { position:absolute; inset:0; mix-blend-mode:screen; pointer-events:none; }
.nebula-layer { position:absolute; width:180vmax; height:180vmax; top:-40vmax; left:-30vmax; filter: blur(40px) saturate(120%); opacity:0.35; }
.nebula-layer.l1 { background: 
  radial-gradient(55vmax 40vmax at 20% 40%, rgba(120,200,255,0.55), rgba(0,0,0,0) 60%),
  radial-gradient(45vmax 35vmax at 65% 60%, rgba(255,120,220,0.45), rgba(0,0,0,0) 60%),
  radial-gradient(35vmax 30vmax at 80% 25%, rgba(255,220,120,0.35), rgba(0,0,0,0) 60%);
  animation: nebula-drift-1 140s linear infinite;
}
.nebula-layer.l2 { background:
  radial-gradient(60vmax 45vmax at 30% 70%, rgba(90,180,255,0.45), rgba(0,0,0,0) 60%),
  radial-gradient(50vmax 40vmax at 70% 30%, rgba(200,110,255,0.35), rgba(0,0,0,0) 60%);
  transform: rotate(20deg) scale(1.1);
  animation: nebula-drift-2 160s linear infinite;
}
.nebula-layer.l3 { background:
  conic-gradient(from 0deg at 50% 50%, rgba(255,0,120,0.08), rgba(0,200,255,0.08), rgba(255,255,120,0.08), rgba(255,0,120,0.08));
  filter: blur(60px) saturate(140%);
  opacity: .25;
  animation: nebula-rotate 220s linear infinite;
}
.nebula-layer.l4 { background:
  radial-gradient(80vmax 60vmax at 50% 50%, rgba(255,255,255,0.12), rgba(0,0,0,0) 70%);
  filter: blur(120px);
  opacity: .2;
  animation: nebula-breathe 18s ease-in-out infinite;
}
.nebula-glow { position:absolute; inset:-10%; background: radial-gradient(60vmax 60vmax at 50% 50%, rgba(30,120,255,0.1), rgba(0,0,0,0) 70%);
  filter: blur(80px); opacity:.2; }

@keyframes nebula-drift-1 { 0%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(6vmax,-4vmax,0) } 100%{ transform: translate3d(0,0,0) } }
@keyframes nebula-drift-2 { 0%{ transform: translate3d(0,0,0) rotate(20deg) scale(1.1)} 50%{ transform: translate3d(-5vmax,5vmax,0) rotate(0deg) scale(1.06)} 100%{ transform: translate3d(0,0,0) rotate(20deg) scale(1.1)} }
@keyframes nebula-rotate { 0%{ transform: rotate(0deg)} 100%{ transform: rotate(360deg)} }
@keyframes nebula-breathe { 0%,100%{ opacity:.18 } 50%{ opacity:.28 } }

/* Subtle star twinkle */
@keyframes twinkle { 0%, 100% { opacity: .7 } 50% { opacity: 1 } }
.twinkle { animation: move-stars 200s linear infinite, twinkle 2.5s ease-in-out infinite; }
.twinkle-slow { animation: move-stars 150s linear infinite, twinkle 4s ease-in-out infinite; opacity:.8; }

/* Film grain overlay */
.noise-overlay { position:absolute; inset:0; pointer-events:none; opacity:.05; mix-blend-mode:screen;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.25"/></svg>'); }

@keyframes pop-and-fade {
  0% {
    opacity: 0;
    transform: scale(0.5) translateY(10px);
  }
  20% {
    opacity: 1;
    transform: scale(1.05) translateY(0);
  }
  80% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
  100% {
    opacity: 0;
    transform: scale(0.9) translateY(-15px);
  }
}

.emoticon-animation {
  animation: pop-and-fade 4s ease-in-out forwards;
}

/* Button Hover Effect (smoother, Mac-like) */
.btn-hover-scale { transition: transform 240ms cubic-bezier(0.22, 1, 0.36, 1); will-change: transform }
.btn-hover-scale:hover { transform: translateZ(0) scale(1.05) }

/* Page curl open (leaderboard, book-like) */
/* Old classes retained for compatibility */
.paper-fold-wrap { perspective: 1400px; transform-style: preserve-3d }
.page-curl-in { position: relative; transform-origin: left center; animation: page-curl-open 640ms cubic-bezier(0.19, 1, 0.22, 1) forwards; will-change: transform, opacity, filter }
.page-curl-in::before { content:""; position:absolute; inset:0; background: linear-gradient(90deg, rgba(0,0,0,0.28), rgba(0,0,0,0.06) 30%, rgba(255,255,255,0.06) 50%, rgba(0,0,0,0.08) 70%, rgba(0,0,0,0.28)); opacity:.0; pointer-events:none; mix-blend-mode:multiply; border-radius:inherit; animation: page-curl-shade 640ms cubic-bezier(0.19, 1, 0.22, 1) forwards }
@keyframes page-curl-open {
  0% { opacity: 0; transform: rotateY(-16deg) scaleX(0.92); filter: blur(6px) }
  55% { opacity: 1; transform: rotateY(6deg) scaleX(1.02); filter: blur(0) }
  100% { opacity: 1; transform: rotateY(0deg) scaleX(1) }
}
@keyframes page-curl-shade {
  0% { opacity: .0; transform: translateX(-2px) }
  50% { opacity: .35; transform: translateX(0) }
  100% { opacity: .12; transform: translateX(0) }
}
/* curled edge highlight */
.page-curl-in::after {
  content: "";
  position: absolute; top: 0; bottom: 0; left: -10px; width: 24px;
  background: radial-gradient(24px 120% at 100% 50%, rgba(255,255,255,0.28), rgba(255,255,255,0) 60%);
  opacity: .0; filter: blur(2px); pointer-events:none;
  animation: page-curl-edge 640ms cubic-bezier(0.19, 1, 0.22, 1) forwards;
}
@keyframes page-curl-edge { 0% { opacity: 0 } 50% { opacity: .35 } 100% { opacity: .12 } }

/* Smoother slime/scale animations */
.animate-slime-in { animation-duration: 600ms; animation-timing-function: cubic-bezier(0.19, 1, 0.22, 1) }
.animate-scale-in { animation-duration: 600ms; animation-timing-function: cubic-bezier(0.19, 1, 0.22, 1) }

/* New stone animations */
@keyframes stone-drop { 0% { transform: translateY(-14px) scale(0.4) rotate(-8deg); filter: drop-shadow(0 0 0 rgba(0,0,0,0)) } 55% { transform: translateY(2px) scale(1.05) rotate(2deg); filter: drop-shadow(0 6px 8px rgba(0,0,0,0.4)) } 75% { transform: translateY(-1px) scale(0.98) rotate(-1deg) } 100% { transform: translateY(0) scale(1) rotate(0deg); filter: drop-shadow(0 3px 6px rgba(0,0,0,0.35)) } }
.stone-pop { animation: stone-drop 320ms cubic-bezier(.21,.98,.6,.99); transform-origin: 50% 50% }
@keyframes ring-ripple { 0% { transform: scale(0.2); opacity: .35 } 70% { opacity: .12 } 100% { transform: scale(1.25); opacity: 0 } }
.stone-ripple { position:absolute; border:2px solid rgba(255,255,255,0.5); border-radius:9999px; pointer-events:none; animation: ring-ripple 600ms ease-out forwards; mix-blend-mode:screen }

/* Mobile and reduced-motion optimizations */
@media (prefers-reduced-motion: reduce) {
  .btn-hover-scale,
  .page-curl-in,
  .animate-slime-in,
  .animate-scale-in,
  .stone-pop,
  .stone-ripple,
  .twinkle,
  .twinkle-slow { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important }
}
@media (max-width: 640px) {
  .nebula-layer { filter: blur(30px) saturate(110%); opacity: .30 }
  .noise-overlay { opacity: .03 }
}

/* Enriched nebula palette */
.nebula-layer.l1 { background: 
  radial-gradient(55vmax 40vmax at 20% 40%, rgba(120,200,255,0.55), rgba(0,0,0,0) 60%),
  radial-gradient(45vmax 35vmax at 65% 60%, rgba(255,120,220,0.45), rgba(0,0,0,0) 60%),
  radial-gradient(35vmax 30vmax at 80% 25%, rgba(255,220,120,0.35), rgba(0,0,0,0) 60%),
  radial-gradient(50vmax 30vmax at 10% 80%, rgba(120,255,200,0.25), rgba(0,0,0,0) 60%);
}
.nebula-layer.l2 { background:
  radial-gradient(60vmax 45vmax at 30% 70%, rgba(90,180,255,0.45), rgba(0,0,0,0) 60%),
  radial-gradient(50vmax 40vmax at 70% 30%, rgba(200,110,255,0.35), rgba(0,0,0,0) 60%),
  radial-gradient(45vmax 28vmax at 50% 15%, rgba(255,140,120,0.25), rgba(0,0,0,0) 60%);
}

/* ColorSelect subtle pulse */
@keyframes soft-pulse {
  0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.12); }
  70% { box-shadow: 0 0 0 12px rgba(255,255,255,0); }
  100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
}

.soft-pulse {
  animation: soft-pulse 1.8s ease-out infinite;
}

@keyframes dynamic-pop {
  0% {
    opacity: 0;
    transform: scale(0.3) translateY(10px) translateX(-20px);
  }
  40% {
    opacity: 1;
    transform: scale(1.1) translateY(-5px) translateX(5px);
  }
  60% {
    transform: scale(1) translateY(0) translateX(0);
  }
  85% {
    opacity: 1;
    transform: scale(1) translateY(0) translateX(0);
  }
  100% {
    opacity: 0;
    transform: scale(0.8) translateY(-30px);
  }
}

@keyframes hyper-dynamic-pop {
  0% {
    opacity: 0;
    transform: scale(0.2) rotate(-45deg) translateY(20px);
  }
  30% {
    opacity: 1;
    transform: scale(1.3) rotate(15deg) translateY(-10px);
  }
  50% {
    transform: scale(0.9) rotate(-10deg) translateY(0);
  }
  70% {
    transform: scale(1.1) rotate(5deg) translateY(-5px);
  }
  85% {
    transform: scale(1) rotate(0deg) translateY(0);
  }
  100% {
    opacity: 0;
    transform: scale(0.5) rotate(45deg) translateY(-30px);
  }
}

@keyframes super-energetic-pop {
  0% {
    opacity: 0;
    transform: scale(0.1) rotate(-90deg) translateY(50px);
  }
  20% {
    opacity: 1;
    transform: scale(1.5) rotate(20deg) translateY(-20px);
  }
  40% {
    transform: scale(0.8) rotate(-20deg) translateY(10px);
  }
  60% {
    transform: scale(1.2) rotate(10deg) translateY(-10px);
  }
  80% {
    transform: scale(1) rotate(0deg) translateY(0);
  }
  100% {
    opacity: 0;
    transform: scale(0.5) translateY(20px) rotate(90deg);
  }
}

.emoticon-final-animation {
  animation: super-energetic-pop 2.8s ease-in-out forwards;
}

@keyframes flashing-red {
  0%, 100% { background-color: rgba(255, 0, 0, 0.3); }
  50% { background-color: rgba(255, 0, 0, 0.1); }
}

.forbidden-move-marker {
  animation: flashing-red 1.5s infinite;
}


.emoticon-hyper-animation {
  animation: hyper-dynamic-pop 2.5s ease-in-out forwards;
}

.emoticon-display-animation {
  animation: dynamic-pop 3s ease-in-out forwards;
}

@keyframes red-shadow-pulse {
  0% {
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.4), 10px 10px 30px rgba(0,0,0,0.4), inset 0 0 10px rgba(0,0,0,0.2);
  }
  50% {
    box-shadow: 0 0 40px rgba(255, 0, 0, 0.8), 10px 10px 30px rgba(0,0,0,0.4), inset 0 0 10px rgba(0,0,0,0.2);
  }
  100% {
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.4), 10px 10px 30px rgba(0,0,0,0.4), inset 0 0 10px rgba(0,0,0,0.2);
  }
}

.animate-red-shadow {
  animation: red-shadow-pulse 2s infinite;
}

@keyframes slime-in {
    from {
        transform: scale(1.5);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

.animate-slime-in {
    animation: slime-in 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

@keyframes chroma-shine {
  0% {
    box-shadow: 0 0 10px 2px #ff00ff, 2px 2px 5px rgba(0,0,0,0.5);
  }
  25% {
    box-shadow: 0 0 10px 2px #00ffff, 2px 2px 5px rgba(0,0,0,0.5);
  }
  50% {
    box-shadow: 0 0 10px 2px #ffff00, 2px 2px 5px rgba(0,0,0,0.5);
  }
  75% {
    box-shadow: 0 0 10px 2px #00ff00, 2px 2px 5px rgba(0,0,0,0.5);
  }
  100% {
    box-shadow: 0 0 10px 2px #ff00ff, 2px 2px 5px rgba(0,0,0,0.5);
  }
}

.animate-chroma-shine {
  animation: chroma-shine 2s linear infinite;
}

/* Distinctive start animation */
@keyframes board-swoop {
  0% { transform: perspective(800px) translateY(10px) scale(0.94) rotateX(2deg) rotateZ(-0.4deg); opacity: 0.7; }
  60% { transform: perspective(800px) translateY(-2px) scale(1.02) rotateX(0.4deg) rotateZ(0deg); opacity: 1; }
  100% { transform: perspective(800px) translateY(0) scale(1) rotateX(0deg) rotateZ(0deg); opacity: 1; }
}
.start-swoop {
  animation: board-swoop 720ms cubic-bezier(0.2, 0.8, 0.2, 1) both;
}

@keyframes glow-sweep {
  0% { left: -60%; opacity: 0.0; }
  10% { opacity: 0.22; }
  50% { opacity: 0.18; }
  100% { left: 160%; opacity: 0.0; }
}
.glow-sweep {
  position: absolute;
  top: 0;
  left: -60%;
  width: 60%;
  height: 100%;
  background: linear-gradient(105deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.25) 50%, rgba(255,255,255,0) 100%);
  filter: blur(3px);
  animation: glow-sweep 900ms ease-out forwards;
  pointer-events: none;
}

/* DifficultySelect specifics could reuse existing classes; no extra CSS needed now */
/* Countdown line animation for color select */
@keyframes bar-countdown { from { transform: scaleX(1) } to { transform: scaleX(0) } }
.countdown-line { transform-origin: left center; will-change: transform; animation: bar-countdown var(--cd,3s) linear forwards }

/* Intro tile-by-tile reveal */
@keyframes tile-reveal { 0% { opacity: .85; transform: translate(-6px, -6px) scale(1.02) } 70% { opacity: .15 } 100% { opacity: 0; transform: translate(0,0) scale(1) } }
.intro-tile { background: rgba(0,0,0,0.35); animation: tile-reveal 520ms cubic-bezier(.2,.8,.2,1) both }

/* New PageCurl component styles */
.curl-wrap { perspective: 1000px; transform-style: preserve-3d }
.curl-page { position: relative; transform-origin: right bottom; border-radius: 12px; overflow: hidden; will-change: transform, filter, opacity; box-shadow: none; transform-style: preserve-3d }
.curl-page.top-origin { transform-origin: top center }
.scroll-mask { position: relative; overflow: hidden; clip-path: inset(0 0 0 0 round 12px); transform-style: preserve-3d; backface-visibility: hidden; will-change: transform, clip-path }
.static-content { position: relative; z-index: 0 }
.size-probe { visibility: hidden }
.curl-face { position: relative; transform-origin: top center; transform-style: preserve-3d; will-change: transform }
.side { position:absolute; inset:0; backface-visibility: hidden; transform-style: preserve-3d }
.side.front { transform: rotateX(0deg) }
.side.back { transform: rotateX(180deg) }
.curl-content { position: relative; z-index: 1; transform-style: preserve-3d; backface-visibility: hidden; will-change: transform }
.curl-content.back { filter: brightness(0.78) saturate(0.95) }
.curl-content { position: relative; z-index: 2 }
.curl-texture { position:absolute; inset:0; z-index:1; opacity:.08; pointer-events:none; background-image:
  repeating-linear-gradient(0deg, rgba(255,255,255,0.06) 0px, rgba(255,255,255,0.06) 1px, rgba(0,0,0,0) 2px),
  url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.12"/></svg>');
  background-size: auto, 120px 120px;
}
.curl-shade { position:absolute; inset:0; z-index:3; pointer-events:none; opacity:.0; background: radial-gradient(100% 120% at 50% 50%, rgba(0,0,0,0.12), rgba(0,0,0,0)); }
.curl-specular { display:none !important }
.curl-open { animation: corner-open 700ms cubic-bezier(.16,1,.3,1) forwards }
.curl-open-top { animation: none !important }
.curl-open-top .scroll-mask { animation: none !important }
.curl-open-top .curl-face { animation: none !important }
.curl-open-top .curl-content { animation: none !important }
.curl-closed { animation: curl-close 420ms cubic-bezier(.4,0,.2,1) forwards }
@keyframes corner-open {
  0% { transform: rotateX(-6deg) rotateY(14deg) translateZ(0) scale(0.98); filter: blur(5px); opacity:0 }
  45% { transform: rotateX(4deg) rotateY(-6deg) translateZ(0) scale(1.01); filter: blur(0); opacity:1 }
  100% { transform: rotateX(0deg) rotateY(0deg) translateZ(0) scale(1); opacity:1 }
}
@keyframes top-roll-open {
  0% { transform: translateY(-8px) }
  100% { transform: translateY(0) }
}
@keyframes face-roll { 0% { transform: rotateX(180deg) } 60% { transform: rotateX(70deg) } 100% { transform: rotateX(0deg) } }
@keyframes mask-open { 0% { clip-path: inset(0 0 100% 0 round 12px) } 60% { clip-path: inset(0 0 6% 0 round 12px) } 100% { clip-path: inset(0 0 0 0 round 12px) } }
@keyframes content-unroll { 0% { transform: translateY(-6px) scaleY(0.98) } 60% { transform: translateY(0) scaleY(1.01) } 100% { transform: translateY(0) scaleY(1) } }

/* Close roll-up animations */
.curl-close-top { animation: none !important }
.curl-close-top .scroll-mask { animation: none !important }
.curl-close-top .curl-face { animation: none !important }
.curl-close-top .curl-content { animation: none !important }
@keyframes top-roll-close { 0% { transform: translateY(0) } 100% { transform: translateY(-8px) } }
@keyframes face-roll-close { 0% { transform: rotateX(0deg) } 100% { transform: rotateX(180deg) } }
@keyframes mask-close { 0% { clip-path: inset(0 0 0 0 round 12px) } 100% { clip-path: inset(0 0 100% 0 round 12px) } }
@keyframes content-roll { 0% { transform: translateY(0) scaleY(1) } 100% { transform: translateY(-6px) scaleY(0.98) } }
@keyframes curl-close {
  0% { transform: rotateY(0deg) scaleX(1); filter: none; opacity:1 }
  100% { transform: rotateY(-20deg) scaleX(0.9); filter: blur(4px); opacity:0.92 }
}
.curl-open ~ .curl-shade, .curl-open .curl-shade { animation: corner-shade 700ms cubic-bezier(.16,1,.3,1) forwards }
.curl-shade { display:none !important }

/* Corner highlight overlay */
.curl-corner { position:absolute; right:0; bottom:0; width:120px; height:120px; z-index:4; pointer-events:none; opacity:0; clip-path: polygon(100% 0, 100% 100%, 0 100%); background:
  radial-gradient(120px 120px at 100% 100%, rgba(255,255,255,0.25), rgba(255,255,255,0) 60%);
}
.curl-open ~ .curl-corner, .curl-open .curl-corner { animation: corner-spec 700ms cubic-bezier(.16,1,.3,1) forwards }
@keyframes corner-spec { 0% { opacity:0; transform: translate(24px,24px) rotate(10deg) } 50% { opacity:.35; transform: translate(0,0) rotate(0deg) } 100% { opacity:.16; transform: translate(0,0) rotate(0deg) } }

/* Top roll cap (visual rolled cylinder) */
/* Roll cap: visual cylinder edge highlight */
.roll-cap { position:absolute; left:0; right:0; top:0; height: var(--roll-cap-h, 16px); z-index:3; pointer-events:none; opacity:0; transform-origin: top center; transform-style: preserve-3d;
  background:
    linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.15) 40%, rgba(0,0,0,0.35) 70%, rgba(0,0,0,0.0));
  box-shadow: 0 8px 16px rgba(0,0,0,0.35);
  border-radius: 12px 12px 0 0;
}
.roll-staff { position:absolute; left:0; right:0; top:0; height: var(--roll-staff-h, 8px); z-index:4; pointer-events:none; opacity:0; transform-origin: top center; transform-style: preserve-3d;
  background: linear-gradient(180deg, #6b4f2a, #3f2d1a);
  box-shadow: 0 2px 6px rgba(0,0,0,0.35);
  border-radius: 10px;
}
.roll-orn { position:absolute; top:0; width:22px; height:22px; z-index:5; pointer-events:none; opacity:0; transform-origin: top center; transform-style: preserve-3d;
  border-radius: 9999px; box-shadow: 0 2px 8px rgba(0,0,0,0.45);
  background: radial-gradient(circle at 30% 30%, #f8e39a, #b89338 60%, #6c5520 100%);
}
.roll-orn.left { left: -10px }
.roll-orn.right { right: -10px }

@media (prefers-reduced-motion: reduce) { .curl-open-top, .curl-face { animation-duration: 1ms !important; animation-iteration-count: 1 !important } }

/* Depth shadow under unrolling page */
.curl-depth { display:none !important }

@media (prefers-reduced-motion: reduce) {
  .curl-open, .curl-closed, .curl-shade, .curl-specular { animation-duration: 1ms !important; animation-iteration-count: 1 !important }
}
.curl-bend { position:absolute; top:0; left:0; right:0; height:24px; z-index:1; pointer-events:none; opacity:0; background:
  linear-gradient(180deg, rgba(255,255,255,0.28), rgba(255,255,255,0) 65%),
  linear-gradient(0deg, rgba(0,0,0,0.25), rgba(0,0,0,0) 70%);
  mix-blend-mode: screen; filter: blur(1px);
}
.curl-open-top .curl-bend { animation: bend-open 1500ms cubic-bezier(.19,1,.22,1) forwards }
@keyframes bend-open { 0% { opacity:.0; transform: translateY(-10px) } 50% { opacity:.55; transform: translateY(0) } 100% { opacity:.14; transform: translateY(0) } }
.slices { position: relative; transform-style: preserve-3d; z-index: 2; pointer-events: none }
.slice { position:absolute; inset:0; clip-path: inset(var(--top) 0 var(--bottom) 0 round 12px); transform-origin: top center; will-change: transform; pointer-events: none }
.slice-face { position:relative; transform-style: preserve-3d; backface-visibility: hidden; pointer-events: none; filter: brightness(var(--br,1)) }
.slice-texture { position:absolute; inset:0; pointer-events:none; opacity: var(--texture-opacity, .1); background-image:
  radial-gradient(120% 140% at 50% 10%, rgba(255,255,255,0.10), rgba(255,255,255,0) 60%),
  repeating-linear-gradient(180deg, rgba(0,0,0,0.04) 0, rgba(0,0,0,0.04) 2px, rgba(0,0,0,0.0) 3px, rgba(0,0,0,0.0) 6px);
  mix-blend-mode: soft-light;
}
.slice-side { position:absolute; inset:0; backface-visibility: hidden; transform-style: preserve-3d; pointer-events: none }
.slice-side.front { transform: rotateX(0deg) }
.slice-side.back { transform: rotateX(180deg) }
.slice-html { position:absolute; inset:0; pointer-events: none }
.slice-html.back { filter: brightness(0.78) saturate(0.95) }
/* JS-driven transforms for slice-face; disable CSS animations to avoid conflicts */
.curl-open-top .slice-face, .curl-close-top .slice-face { animation: none !important }
.slice-band { position:absolute; inset:0; background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0) 30%, rgba(0,0,0,0.1) 90%, rgba(0,0,0,0)); opacity: 0; pointer-events:none }
.curl-open-top .slice .slice-band { animation: none !important }
.curl-close-top .slice .slice-band { animation: none !important }

/* Disable legacy mask/face animations when JS-driven roll is active */
.curl-open-top .scroll-mask, .curl-close-top .scroll-mask, .curl-open-top .curl-face, .curl-close-top .curl-face { animation: none !important }
@keyframes band-fade { 0% { opacity: .0 } 50% { opacity: .4 } 100% { opacity: .08 } }

/* Scroll texture overlay on slices */
.slice-texture { position:absolute; inset:0; pointer-events:none; opacity: var(--texture-opacity, .1); background-image:
  radial-gradient(120% 140% at 50% 10%, rgba(255,255,255,0.10), rgba(255,255,255,0) 60%),
  repeating-linear-gradient(180deg, rgba(0,0,0,0.04) 0, rgba(0,0,0,0.04) 2px, rgba(0,0,0,0.0) 3px, rgba(0,0,0,0.0) 6px);
  mix-blend-mode: soft-light;
}

/* Scroll Themes via CSS variables */
.scroll-theme-parchment { --texture-opacity: .10 }
.scroll-theme-hanji { --texture-opacity: .12 }
.scroll-theme-dark { --texture-opacity: .08 }
.scroll-theme-royal { --texture-opacity: .12 }

/* Rolling edge cast shadow */
.roll-shadow { position:absolute; left:0; right:0; top:0; height:24px; z-index:0; opacity:0; pointer-events:none; background:
  linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.03) 90%, rgba(0,0,0,0.0) 100%);
  will-change: transform, opacity, filter;
}
